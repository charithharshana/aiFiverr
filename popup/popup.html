<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>aiFiverr Assistant</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <!-- Header -->
    <header class="popup-header">
      <div class="logo">
        <img src="../icons/icon48.png" alt="aiFiverr" class="logo-icon">
        <h1>aiFiverr</h1>
      </div>
      <div class="status-indicator" id="statusIndicator">
        <span class="status-dot"></span>
        <span class="status-text">Ready</span>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="tab-navigation">
      <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
      <button class="tab-btn" data-tab="api">API Config</button>
      <button class="tab-btn" data-tab="settings">Settings</button>
      <button class="tab-btn" data-tab="export">Export</button>
    </nav>

    <!-- Tab Content -->
    <main class="tab-content">
      <!-- Dashboard Tab -->
      <div class="tab-panel active" id="dashboard">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üí¨</div>
            <div class="stat-info">
              <div class="stat-number" id="totalConversations">0</div>
              <div class="stat-label">Conversations</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üîë</div>
            <div class="stat-info">
              <div class="stat-number" id="healthyKeys">0</div>
              <div class="stat-label">Healthy API Keys</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üìù</div>
            <div class="stat-info">
              <div class="stat-number" id="totalPrompts">0</div>
              <div class="stat-label">Custom Prompts</div>
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <h3>Quick Actions</h3>
          <div class="action-buttons">
            <button class="action-btn" id="extractConversation">
              <span class="btn-icon">üì•</span>
              Extract Conversation
            </button>
            <button class="action-btn" id="generateReply">
              <span class="btn-icon">‚ú®</span>
              Generate Reply
            </button>
            <button class="action-btn" id="analyzeMessage">
              <span class="btn-icon">üîç</span>
              Analyze Message
            </button>
            <button class="action-btn" id="openFloatingWidget">
              <span class="btn-icon">ü§ñ</span>
              Open AI Assistant
            </button>
          </div>
        </div>

        <div class="recent-activity">
          <h3>Recent Activity</h3>
          <div class="activity-list" id="activityList">
            <div class="activity-item">
              <div class="activity-icon">üí¨</div>
              <div class="activity-content">
                <div class="activity-title">Welcome to aiFiverr!</div>
                <div class="activity-time">Just now</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- API Configuration Tab -->
      <div class="tab-panel" id="api">
        <div class="settings-section">
          <h3>Gemini AI Model</h3>
          <div class="api-model-container">
            <div class="model-selection">
              <label for="defaultModel">Select AI Model:</label>
              <select id="defaultModel">
                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
              </select>
              <p class="model-description">Choose the Gemini model for AI responses. Flash models are faster, Pro models are more capable.</p>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>API Keys</h3>
          <div class="api-keys-container">
            <div class="api-keys-input-section">
              <div class="api-keys-input-wrapper">
                <textarea
                  id="apiKeysInput"
                  placeholder="Enter your Gemini API keys (one per line)&#10;AIzaSyC...&#10;AIzaSyD..."
                  rows="4"
                ></textarea>
                <button class="api-keys-visibility-toggle" id="toggleApiKeysVisibility" title="Toggle API keys visibility">
                  <span class="eye-icon" id="eyeIcon">üëÅÔ∏è</span>
                </button>
              </div>
              <div class="api-keys-actions">
                <button class="btn-secondary" id="testApiKeys">Test Keys</button>
                <button class="btn-secondary" id="clearApiKeys">Clear All</button>
              </div>
            </div>
            <div class="api-keys-status" id="apiKeysStatus"></div>
            <div class="api-keys-summary" id="apiKeysSummary"></div>
          </div>
        </div>

        <div class="settings-section">
          <h3>API Configuration</h3>
          <div class="api-config-container">
            <div class="config-item">
              <label for="apiTimeout">Request Timeout (seconds)</label>
              <input type="number" id="apiTimeout" value="30" min="10" max="120">
            </div>
            <div class="config-item">
              <label for="maxRetries">Max Retries</label>
              <input type="number" id="maxRetries" value="3" min="1" max="10">
            </div>
            <div class="config-item">
              <label for="keyRotation">Enable API Key Rotation</label>
              <input type="checkbox" id="keyRotation" checked>
            </div>
          </div>
          <div class="api-save-section">
            <button class="btn-primary api-save-btn" id="apiSaveBtn">üíæ Save API Configuration</button>
            <p class="save-description">Save API model, keys, and configuration settings</p>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div class="tab-panel" id="settings">
        <div class="settings-section">
          <h3>Knowledge Base</h3>
          <div class="knowledge-base-container">
            <div class="kb-header">
              <p class="kb-description">Create variables for AI responses. Use <code>{{variable_name}}</code> in prompts.</p>
              <div class="kb-header-actions">
                <button class="btn-secondary kb-populate-btn" id="populateFromPrompts">Auto-populate from Prompts</button>
                <button class="btn-primary kb-add-btn" id="addKnowledgeItem">+ Add</button>
              </div>
            </div>

            <!-- Add/Edit Form -->
            <div class="kb-form-overlay" id="knowledgeFormOverlay">
              <div class="kb-form-modal">
                <div class="kb-form-header">
                  <h4 id="kbFormTitle">Add Variable</h4>
                  <button class="kb-form-close" id="closeKnowledgeForm">√ó</button>
                </div>
                <div class="kb-form-body">
                  <div class="kb-form-group">
                    <label for="newKbKey">Name</label>
                    <input type="text" id="newKbKey" placeholder="bio, services, experience" class="kb-input">
                  </div>
                  <div class="kb-form-group">
                    <label for="newKbValue">Value</label>
                    <textarea id="newKbValue" placeholder="Enter content..." class="kb-textarea" rows="3"></textarea>
                  </div>
                </div>
                <div class="kb-form-footer">
                  <button class="btn-secondary" id="cancelKnowledgeItem">Cancel</button>
                  <button class="btn-primary" id="saveKnowledgeItem">Save</button>
                </div>
              </div>
            </div>

            <!-- Variables List -->
            <div class="kb-variables-list" id="knowledgeBaseList">
              <!-- Variables will be populated here -->
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>Prompt Management</h3>
          <div class="prompt-management-container">
            <div class="prompt-management-header">
              <p class="prompt-management-description">
                Create and manage custom prompts for different scenarios. Favorite your most-used prompts for quick access.
              </p>
              <div class="prompt-management-tabs">
                <button class="prompt-tab-btn active" data-tab="custom">Custom Prompts</button>
                <button class="prompt-tab-btn" data-tab="default">Default Prompts</button>
                <button class="prompt-tab-btn" data-tab="favorites">Favorites</button>
              </div>
            </div>

            <div class="prompt-add-button-container">
              <button class="btn-primary" id="addPromptBtn">+ Add Custom Prompt</button>
            </div>

            <div class="prompt-add-form" id="promptAddForm">
              <div class="prompt-form-field">
                <label for="newPromptKey" class="field-label">
                  Prompt Key <span class="field-help" title="Unique identifier for this prompt. Use lowercase letters, numbers, and underscores only.">‚ÑπÔ∏è</span>
                </label>
                <input type="text" id="newPromptKey" placeholder="e.g., professional_reply" class="prompt-key-input">
                <small class="field-description">Unique identifier (letters, numbers, underscores only)</small>
              </div>

              <div class="prompt-form-field">
                <label for="newPromptName" class="field-label">
                  Display Name <span class="field-help" title="Human-readable name shown in the interface">‚ÑπÔ∏è</span>
                </label>
                <input type="text" id="newPromptName" placeholder="e.g., Professional Reply" class="prompt-name-input">
                <small class="field-description">Friendly name displayed in the prompt list</small>
              </div>

              <div class="prompt-form-field">
                <label for="newPromptDescription" class="field-label">
                  Description <span class="field-help" title="Brief explanation of what this prompt does and when to use it">‚ÑπÔ∏è</span>
                </label>
                <textarea id="newPromptDescription" placeholder="Brief description of what this prompt does..." class="prompt-description-input" rows="2"></textarea>
                <small class="field-description">Explain what this prompt does and when to use it</small>
              </div>

              <div class="prompt-form-field">
                <label for="newPromptContent" class="field-label">
                  Prompt Content <span class="field-help" title="The actual prompt text. Use {{variable_name}} to reference knowledge base variables and {conversation} for Fiverr conversation data">‚ÑπÔ∏è</span>
                </label>
                <textarea id="newPromptContent" placeholder="Enter your prompt content here. Use {{variable_name}} to reference knowledge base variables..." class="prompt-content-input" rows="6"></textarea>
                <small class="field-description">Use {{variable_name}} for knowledge base variables, {conversation} for Fiverr data</small>
              </div>

              <div class="prompt-form-actions">
                <button class="btn-primary" id="savePromptBtn">Save Prompt</button>
                <button class="btn-secondary" id="cancelPromptBtn">Cancel</button>
              </div>
            </div>

            <div class="prompt-tab-content">
              <div class="prompt-panel active" id="customPromptsPanel">
                <div class="prompt-list" id="customPromptsList"></div>
              </div>
              <div class="prompt-panel" id="defaultPromptsPanel">
                <div class="prompt-list" id="defaultPromptsList"></div>
              </div>
              <div class="prompt-panel" id="favoritesPanel">
                <div class="prompt-list" id="favoritePromptsList"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>Preferences</h3>
          <div class="preferences-container">
            <div class="preference-item">
              <label for="autoSave">Auto-save sessions</label>
              <input type="checkbox" id="autoSave" checked>
            </div>
            <div class="preference-item">
              <label for="notifications">Show notifications</label>
              <input type="checkbox" id="notifications" checked>
            </div>
            <div class="preference-item">
              <label for="maxContextLength">Max context length</label>
              <input type="number" id="maxContextLength" value="10000" min="1000" max="50000">
            </div>
          </div>
          <div class="global-save-section">
            <button class="btn-primary global-save-btn" id="globalSaveBtn">üíæ Save All Settings</button>
            <p class="save-description">Save all API keys, preferences, and configurations</p>
          </div>
        </div>
      </div>

      <!-- Export Tab -->
      <div class="tab-panel" id="export">
        <!-- Fiverr Conversation Extraction -->
        <div class="fiverr-section">
          <h3>üéØ Fiverr Conversation Extraction</h3>
          <div class="fiverr-status" id="fiverrStatus">
            <div class="status-indicator" id="fiverrStatusIndicator">‚ö™</div>
            <span id="fiverrStatusText">Ready to extract conversations</span>
          </div>

          <div class="fiverr-actions">
            <div class="action-group">
              <button class="btn-primary" id="fetchContactsBtn">üìã Fetch All Contacts</button>
              <button class="btn-secondary" id="extractCurrentBtn">üí¨ Extract Current Conversation</button>
            </div>
            <div class="progress-info" id="progressInfo" style="display: none;">
              <div class="progress-text" id="progressText"></div>
              <div class="progress-counter" id="progressCounter"></div>
            </div>
          </div>

          <div class="stored-conversations" id="storedConversations">
            <h4>Stored Conversations</h4>
            <div class="conversations-list" id="conversationsList">
              <div class="no-conversations">No conversations stored yet</div>
            </div>
          </div>

          <div class="contacts-section" id="contactsSection" style="display: none;">
            <h4>Available Contacts</h4>
            <div class="contacts-list" id="contactsList">
              <div class="no-contacts">No contacts found</div>
            </div>
          </div>
        </div>

        <div class="export-section">
          <h3>üì§ Export Data</h3>
          <div class="export-options">
            <div class="export-format">
              <label>Export Format:</label>
              <select id="exportFormat">
                <option value="json">JSON</option>
                <option value="csv">CSV</option>
                <option value="markdown">Markdown</option>
              </select>
            </div>
            <div class="export-actions">
              <button class="btn-primary" id="exportAllData">Export All Data</button>
              <button class="btn-secondary" id="exportSessions">Export Sessions Only</button>
              <button class="btn-secondary" id="exportConversations">Export Conversations Only</button>
            </div>
          </div>
        </div>

        <div class="import-section">
          <h3>Import Data</h3>
          <div class="import-container">
            <div class="file-drop-zone" id="fileDropZone">
              <div class="drop-zone-content">
                <div class="drop-icon">üìÅ</div>
                <div class="drop-text">Drop your export file here or click to browse</div>
              </div>
              <input type="file" id="importFile" accept=".json" hidden>
            </div>
            <div class="import-options">
              <div class="import-option">
                <input type="checkbox" id="importApiKeys">
                <label for="importApiKeys">Import API keys (use with caution)</label>
              </div>
              <div class="import-option">
                <input type="checkbox" id="forceImport">
                <label for="forceImport">Force import (ignore version compatibility)</label>
              </div>
            </div>
            <button class="btn-primary" id="importData" disabled>Import Data</button>
          </div>
        </div>

        <div class="backup-section">
          <h3>Backup & Sync</h3>
          <div class="backup-info">
            <p>Regular backups help you maintain your data across browsers and devices.</p>
            <div class="backup-actions">
              <button class="btn-secondary" id="createBackup">Create Backup</button>
              <button class="btn-secondary" id="scheduleBackup">Schedule Auto-Backup</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="popup-footer">
      <div class="footer-links">
        <a href="#" id="helpLink">Help</a>
        <a href="#" id="feedbackLink">Feedback</a>
        <a href="#" id="aboutLink">About</a>
      </div>
      <div class="version-info">v1.0.0</div>
    </footer>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <div class="loading-text">Processing...</div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="popup.js"></script>
</body>
</html>
