User authentication in Google Apps Script web apps 


 /**
 * User authentication in Google Apps Script web apps
 *  Â© bpwebs.com
 */

const SSID = "1Y8xalfh-wZkM06eYYN1OA_3Y3ZpxvbmaNDoXSagElag"; //ID of the Google Sheets with users table
const SN_USERS = "Users"; //Name of the Google Sheet with user table
const RNG_USER_EMAILS = "B2:B";//User email range


function doGet() {
  let template = HtmlService.createTemplateFromFile('Index');
  let html = template.evaluate().setTitle('Web App with Authentication');
  html.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
  html.addMetaTag('viewport', 'width=device-width, initial-scale=1');
  return html;
}


function getLoginPage(){
  return HtmlService.createHtmlOutputFromFile('Login').getContent();
}

function getNotAuthorizedPage(){
  return HtmlService.createHtmlOutputFromFile('NotAuthorized').getContent();
}

function getDashboardPage(){
  return HtmlService.createHtmlOutputFromFile('Dashboard').getContent();
}


function checkUserAuthorization(userEmail){
  let sheet = SpreadsheetApp.openById(SSID).getSheetByName(SN_USERS); //Open the spreadsheet and get the sheet
  let allowedEmails = sheet.getRange(RNG_USER_EMAILS).getValues().flat().filter(String); //Get all emails in the email column of the sheet
  return allowedEmails.includes(userEmail); // Check if the logged-in user's email exists in the allowed list
}

function getUserStatus() {
  var userEmail = Session.getActiveUser().getEmail();
  if (!userEmail) {
    return {
      loggedIn: false,
      authorized: false
    };
  }
  var isAuthorized = checkUserAuthorization(userEmail);
  return {
    loggedIn: true,
    authorized: isAuthorized,
    email: userEmail
  };
}

function include(filename){
  return HtmlService.createHtmlOutputFromFile(filename).getContent();
}